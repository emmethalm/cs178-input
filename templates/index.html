<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weekly Calendar</title>
<style>

  body {
    background-color: #f4f7f6;
    color: #333;
    font-family: 'Arial', sans-serif;
  }
  .calendar {
    display: grid;
    grid-template-columns: 100px 100px 100px repeat(7, 1fr);
    grid-gap: 1px;
    text-align: center;
    margin: auto;
    max-width: 90vw;
  }
  .hour-header, .day-header {
    font-weight: bold;
    background-color: #2c3e50;
    color: #ffffff;
    padding: 10px;
    border: 1px solid #2c3e50;
  }
  .time-slot {
    padding: 10px;
    border: 1px solid #bdc3c7;
    background-color: #ecf0f1;
    cursor: pointer;
    min-height: 50px; /* Adjust the height of the time slots */
  }
  .time-slot.selected {
    background-color: #3498db;
    color: #ffffff
  }
  .intro {
    text-align: center;
    margin-bottom: 20px;
  }
  .intro h1 {
    margin-bottom: 0.5em;
    color: #2c3e50
  }
  .intro p {
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
    color: #34495e;
  }

  .hour-header.working-hours {
  background: linear-gradient(to right, #4caf50, #8bc34a);
  color: white;
}

.hour-header.waking-hours {
  background: linear-gradient(to right, #ffeb3b, #ffc107);
  color: white;
}

.hour-header.sleeping-hours {
  background: linear-gradient(to right, #f44336, #d32f2f);
  color: white;
}

</style>
</head>
<body>

  <div class="intro">
    <h1>Please fill in your availability below!</h1>
    <p>You have been invited to a meeting by <strong>Elena Glassman</strong> with the meeting subject <strong>CS178 Final Project</strong>. There are <strong>5</strong> other invitees. 
    Please indicate your availability below as well as the minimum number of attendees who must be present in order for you to join the meeting. Happy meeting!</p>
  </div>

<div class="container">
  <div class="calendar">
    <div class="hour-header">PST</div>
    <div class="hour-header">GMT</div>
    <div class="hour-header">EST</div>
  
    <div class="day-header">Sunday</div>
    <div class="day-header">Monday</div>
    <div class="day-header">Tuesday</div>
    <div class="day-header">Wednesday</div>
    <div class="day-header">Thursday</div>
    <div class="day-header">Friday</div>
    <div class="day-header">Saturday</div>

    {% for hour in range(8, 32) %}
    <div class="hour-header {{ 'working-hours' if 9 <= (hour-3)%24 <= 17 else 'waking-hours' if 7 <= (hour-3)%24 < 9 or 17 < (hour-3)%24 < 23 else 'sleeping-hours' }}">
      {{ (hour-3)%12 if (hour-3)%12 != 0 else 12 }}:00 {{ 'AM' if (hour-3)%24 < 12 else 'PM' }} PST
    </div>
    
    <div class="hour-header {{ 'working-hours' if 9 <= (hour+5)%24 <= 17 else 'waking-hours' if 7 <= (hour+5)%24 < 9 or 17 < (hour+5)%24 < 23 else 'sleeping-hours' }}">
      {{ (hour+5)%12 if (hour+5)%12 != 0 else 12 }}:00 {{ 'AM' if (hour+5)%24 < 12 else 'PM' }} GMT
    </div>

    <div class="hour-header {{ 'working-hours' if 9 <= hour%24 <= 17 else 'waking-hours' if 7 <= hour%24 < 9 or 17 < hour%24 < 23 else 'sleeping-hours' }}">
      {{ hour%12 if hour%12 != 0 else 12 }}:00 {{ 'AM' if hour%24 < 12 else 'PM' }} EST
    </div> 
    
    {% for day in range(7) %}
    <div class="time-slot" data-day="{{ day }}" data-hour="{{ hour }}"></div>
    {% endfor %}
    {% endfor %}


  </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
  let isMouseDown = false;
  let selectedHours = [];

  $(document).on('mousedown', '.time-slot', function() {
    isMouseDown = true;
    $(this).toggleClass('selected');
    updateSelectedHours($(this));
    return false; // prevent text selection
  })
  .on('mouseover', '.time-slot', function() {
    if (isMouseDown) {
      $(this).toggleClass('selected');
      updateSelectedHours($(this));
    }
  })
  .on('mouseup', function() {
    isMouseDown = false;
  });

  function updateSelectedHours(element) {
    let day = element.data('day');
    let hour = element.data('hour');
    let id = 'day-' + day + '-hour-' + hour;
    let index = selectedHours.indexOf(id);
    if (index > -1) {
      selectedHours.splice(index, 1);
    } else {
      selectedHours.push(id);
    }
  }

  // Bind to a button click to submit the data
  $('#submit').click(function() {
    $.ajax({
      url: '/availability',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify({availability: selectedHours}),
      success: function(response) {
        alert(response.message);
      }
    });
  });

  // Prevent the default right click context menu on time slots
  $('.time-slot').on('contextmenu', function() {
    return false;
  });
</script>

</body>
</html>
